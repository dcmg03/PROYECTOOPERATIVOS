<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Algoritmo MLFQ</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .bg-warning { background-color: yellow !important; }
        .bg-danger { background-color: red !important; }
        .proceso { margin-bottom: 10px; padding: 10px; }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center mb-4">Simulador de Algoritmo MLFQ</h1>

    <div id="estado-colas" class="row"></div>

    <h2>Procesos Completados</h2>
    <div id="procesos-completados" class="bg-light p-3 border rounded"></div>

    <div class="text-center mt-4">
        <button id="generar-procesos-btn" class="btn btn-primary">Generar Procesos</button>
        <button id="iniciar-simulacion-btn" class="btn btn-success">Iniciar Simulación</button>
        <button id="pausar-simulacion-btn" class="btn btn-warning">Pausar Simulación</button>
        <button id="reiniciar-simulacion-btn" class="btn btn-danger">Reiniciar Simulación</button>
    </div>
</div>

<script>
    function actualizarEstadoColas() {
        $.get('/estado_procesos', function(data) {
            let colasHTML = '';
            data.colas.forEach(function(cola) {
                let procesosHTML = '';
                cola.procesos.forEach(function(proceso) {
                    procesosHTML += `<div class="proceso ${proceso.color}">
                        <strong>${proceso.nombre}</strong><br>
                        Tiempo Restante: ${proceso.tiempo_restante}<br>
                        Estado: ${proceso.estado}
                    </div>`;
                });
                colasHTML += `<div class="col-md-4">
                    <h3>${cola.nombre} (Quantum: ${cola.quantum})</h3>
                    ${procesosHTML || '<p>No hay procesos en esta cola</p>'}
                </div>`;
            });
            $('#estado-colas').html(colasHTML);

            let completadosHTML = '';
            data.completados.forEach(function(proceso) {
                completadosHTML += `<p>${proceso.nombre} - Estado: Completado</p>`;
            });
            $('#procesos-completados').html(completadosHTML);
        });
    }

    $('#generar-procesos-btn').click(function() {
        $.post('/generar_procesos', function() {
            actualizarEstadoColas();
        });
    });

    let intervalId;
    $('#iniciar-simulacion-btn').click(function() {
        intervalId = setInterval(function() {
            $.get('/simular_tick', function() {
                actualizarEstadoColas();
            });
        }, 1000);
    });

    $('#pausar-simulacion-btn').click(function() {
        clearInterval(intervalId);
    });

    $('#reiniciar-simulacion-btn').click(function() {
        $.post('/reiniciar_simulacion', function() {
            actualizarEstadoColas();
        });
    });

    setInterval(actualizarEstadoColas, 2000);
</script>
</body>
</html>
